<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Business Tool - Time Zones & Exchange Rates</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-globe-americas"></i>
                <h1>Global Business Tool</h1>
            </div>
            <p class="subtitle">Time Zones • Exchange Rates • Global Business</p>
        </header>

        <main class="main-content">
            <!-- Time Comparison Module -->
            <div class="time-module">
                <div class="module-header">
                    <h2 class="module-title">Time Comparison</h2>
                </div>
                <div class="time-comparison-grid">
                    <!-- Main Country Selection and Time -->
                    <div class="main-country-section">
                        <div class="main-country-selector">
                            <select id="time-main-country-select" class="main-country-select">
                                <option value="">Select Country</option>
                                <option value="AE">🇦🇪 UAE</option>
                                <option value="AR">🇦🇷 Argentina</option>
                                <option value="AT">🇦🇹 Austria</option>
                                <option value="AU">🇦🇺 Australia</option>
                                <option value="BE">🇧🇪 Belgium</option>
                                <option value="BR">🇧🇷 Brazil</option>
                                <option value="CA">🇨🇦 Canada</option>
                                <option value="CH">🇨🇭 Switzerland</option>
                                <option value="CL">🇨🇱 Chile</option>
                                <option value="CN">🇨🇳 China</option>
                                <option value="CO">🇨🇴 Colombia</option>
                                <option value="CZ">🇨🇿 Czech Republic</option>
                                <option value="DE">🇩🇪 Germany</option>
                                <option value="DK">🇩🇰 Denmark</option>
                                <option value="EG">🇪🇬 Egypt</option>
                                <option value="ES">🇪🇸 Spain</option>
                                <option value="FI">🇫🇮 Finland</option>
                                <option value="FR">🇫🇷 France</option>
                                <option value="GB">🇬🇧 United Kingdom</option>
                                <option value="GR">🇬🇷 Greece</option>
                                <option value="HU">🇭🇺 Hungary</option>
                                <option value="ID">🇮🇩 Indonesia</option>
                                <option value="IE">🇮🇪 Ireland</option>
                                <option value="IL">🇮🇱 Israel</option>
                                <option value="IN">🇮🇳 India</option>
                                <option value="IT">🇮🇹 Italy</option>
                                <option value="JP">🇯🇵 Japan</option>
                                <option value="KE">🇰🇪 Kenya</option>
                                <option value="KR">🇰🇷 South Korea</option>
                                <option value="MA">🇲🇦 Morocco</option>
                                <option value="MX">🇲🇽 Mexico</option>
                                <option value="MY">🇲🇾 Malaysia</option>
                                <option value="NG">🇳🇬 Nigeria</option>
                                <option value="NL">🇳🇱 Netherlands</option>
                                <option value="NO">🇳🇴 Norway</option>
                                <option value="NZ">🇳🇿 New Zealand</option>
                                <option value="PE">🇵🇪 Peru</option>
                                <option value="PH">🇵🇭 Philippines</option>
                                <option value="PL">🇵🇱 Poland</option>
                                <option value="PT">🇵🇹 Portugal</option>
                                <option value="RU">🇷🇺 Russia</option>
                                <option value="SA">🇸🇦 Saudi Arabia</option>
                                <option value="SE">🇸🇪 Sweden</option>
                                <option value="SG">🇸🇬 Singapore</option>
                                <option value="TH">🇹🇭 Thailand</option>
                                <option value="TR">🇹🇷 Turkey</option>
                                <option value="US-CHI">🇺🇸 Chicago</option>
                                <option value="US-DEN">🇺🇸 Denver</option>
                                <option value="US-LA">🇺🇸 Los Angeles</option>
                                <option value="US-NY">🇺🇸 New York</option>
                                <option value="VN">🇻🇳 Vietnam</option>
                                <option value="ZA">🇿🇦 South Africa</option>
                            </select>
                        </div>
                        <button class="set-default-btn main-favorite-btn" data-target="time-main" title="Set as Default">
                            <i class="fas fa-star"></i>
                        </button>
                        <div class="time-input-cell">
                            <label for="time-main-date-input" style="font-size: 0.9rem; color: #666; margin-bottom: 5px; display: block;">Set Date & Time (Editable)</label>
                            <div class="custom-datetime-input-inline">
                                <input type="date" id="time-main-date-input" class="time-date-input-inline">
                                <div class="time-selector-inline">
                                    <select id="time-main-hour-input" class="time-hour-select-inline">
                                        <option value="01">1</option>
                                        <option value="02">2</option>
                                        <option value="03">3</option>
                                        <option value="04">4</option>
                                        <option value="05">5</option>
                                        <option value="06">6</option>
                                        <option value="07">7</option>
                                        <option value="08">8</option>
                                        <option value="09">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                    <span class="time-separator">:</span>
                                    <select id="time-main-minute-input" class="time-minute-select-inline">
                                        <option value="00">00</option>
                                        <option value="05">05</option>
                                        <option value="10">10</option>
                                        <option value="15">15</option>
                                        <option value="20">20</option>
                                        <option value="25">25</option>
                                        <option value="30">30</option>
                                        <option value="35">35</option>
                                        <option value="40">40</option>
                                        <option value="45">45</option>
                                        <option value="50">50</option>
                                        <option value="55">55</option>
                                    </select>
                                    <select id="time-main-ampm-input" class="time-ampm-select-inline">
                                        <option value="AM">AM</option>
                                        <option value="PM">PM</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Countries Selection -->
                    <div class="comparison-countries-section">
                        <h3>Comparison Countries</h3>
                        <div class="comparison-countries-grid">
                            <div class="comparison-country-cell" id="comparison-country-1">
                                <select id="comparison-select-1" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="1" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="comparison-country-2">
                                <select id="comparison-select-2" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="2" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="comparison-country-3">
                                <select id="comparison-select-3" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="3" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="comparison-country-4">
                                <select id="comparison-select-4" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="4" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Countries Time Display -->
                    <div class="comparison-times-section">
                        <h3>Comparison Times</h3>
                        <div class="comparison-times-grid">
                            <div class="time-display-cell" id="time-comparison-display-1">
                            </div>
                            <div class="time-display-cell" id="time-comparison-display-2">
                            </div>
                            <div class="time-display-cell" id="time-comparison-display-3">
                            </div>
                            <div class="time-display-cell" id="time-comparison-display-4">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exchange Rate Module -->
            <div class="rate-module">
                <div class="module-header">
                    <h2 class="module-title">Exchange Rate</h2>
                </div>
                <div class="rate-comparison-grid">
                    <!-- Main Country Selection -->
                    <div class="main-country-section">
                        <div class="main-country-selector">
                            <select id="rate-base-country" class="main-country-select rate-main-country-select">
                                <option value="">Select Country</option>
                                <option value="AE">🇦🇪 UAE (AED)</option>
                                <option value="AR">🇦🇷 Argentina (ARS)</option>
                                <option value="AT">🇦🇹 Austria (EUR)</option>
                                <option value="AU">🇦🇺 Australia (AUD)</option>
                                <option value="BE">🇧🇪 Belgium (EUR)</option>
                                <option value="BR">🇧🇷 Brazil (BRL)</option>
                                <option value="CA">🇨🇦 Canada (CAD)</option>
                                <option value="CH">🇨🇭 Switzerland (CHF)</option>
                                <option value="CL">🇨🇱 Chile (CLP)</option>
                                <option value="CN">🇨🇳 China (CNY)</option>
                                <option value="CO">🇨🇴 Colombia (COP)</option>
                                <option value="CZ">🇨🇿 Czech Republic (CZK)</option>
                                <option value="DE">🇩🇪 Germany (EUR)</option>
                                <option value="DK">🇩🇰 Denmark (DKK)</option>
                                <option value="EG">🇪🇬 Egypt (EGP)</option>
                                <option value="ES">🇪🇸 Spain (EUR)</option>
                                <option value="FI">🇫🇮 Finland (EUR)</option>
                                <option value="FR">🇫🇷 France (EUR)</option>
                                <option value="GB">🇬🇧 United Kingdom (GBP)</option>
                                <option value="GR">🇬🇷 Greece (EUR)</option>
                                <option value="HU">🇭🇺 Hungary (HUF)</option>
                                <option value="ID">🇮🇩 Indonesia (IDR)</option>
                                <option value="IE">🇮🇪 Ireland (EUR)</option>
                                <option value="IL">🇮🇱 Israel (ILS)</option>
                                <option value="IN">🇮🇳 India (INR)</option>
                                <option value="IT">🇮🇹 Italy (EUR)</option>
                                <option value="JP">🇯🇵 Japan (JPY)</option>
                                <option value="KE">🇰🇪 Kenya (KES)</option>
                                <option value="KR">🇰🇷 South Korea (KRW)</option>
                                <option value="MA">🇲🇦 Morocco (MAD)</option>
                                <option value="MX">🇲🇽 Mexico (MXN)</option>
                                <option value="MY">🇲🇾 Malaysia (MYR)</option>
                                <option value="NG">🇳🇬 Nigeria (NGN)</option>
                                <option value="NL">🇳🇱 Netherlands (EUR)</option>
                                <option value="NO">🇳🇴 Norway (NOK)</option>
                                <option value="NZ">🇳🇿 New Zealand (NZD)</option>
                                <option value="PE">🇵🇪 Peru (PEN)</option>
                                <option value="PH">🇵🇭 Philippines (PHP)</option>
                                <option value="PL">🇵🇱 Poland (PLN)</option>
                                <option value="PT">🇵🇹 Portugal (EUR)</option>
                                <option value="RU">🇷🇺 Russia (RUB)</option>
                                <option value="SA">🇸🇦 Saudi Arabia (SAR)</option>
                                <option value="SE">🇸🇪 Sweden (SEK)</option>
                                <option value="SG">🇸🇬 Singapore (SGD)</option>
                                <option value="TH">🇹🇭 Thailand (THB)</option>
                                <option value="TR">🇹🇷 Turkey (TRY)</option>
                                <option value="US">🇺🇸 United States (USD)</option>
                                <option value="VN">🇻🇳 Vietnam (VND)</option>
                                <option value="ZA">🇿🇦 South Africa (ZAR)</option>
                            </select>
                        </div>
                        <button class="set-default-btn main-favorite-btn" data-target="rate-main" title="Set as Default">
                            <i class="fas fa-star"></i>
                        </button>
                        <div class="rate-display-cell">
                            <div class="rate-display">
                                <input type="number" id="rate-main-value" class="rate-value-input" value="" step="0.0001" min="0" placeholder="INPUT NUMBERS">
                                <div class="rate-currency" id="rate-main-currency"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Countries Selection -->
                    <div class="comparison-countries-section">
                        <h3>Comparison Countries</h3>
                        <div class="comparison-countries-grid">
                            <div class="comparison-country-cell" id="rate-comparison-country-1">
                                <select id="rate-comparison-select-1" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="rate-1" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="rate-comparison-country-2">
                                <select id="rate-comparison-select-2" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="rate-2" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="rate-comparison-country-3">
                                <select id="rate-comparison-select-3" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="rate-3" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                            <div class="comparison-country-cell" id="rate-comparison-country-4">
                                <select id="rate-comparison-select-4" class="comparison-country-select">
                                    <option value="">Select Country</option>
                                </select>
                                <button class="set-default-btn" data-target="rate-4" title="Set as Default">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Countries Rate Display -->
                    <div class="comparison-rates-section">
                        <h3>Exchange Rates</h3>
                        <div class="comparison-rates-grid">
                            <div class="rate-display-cell" id="rate-comparison-display-1">
                            </div>
                            <div class="rate-display-cell" id="rate-comparison-display-2">
                            </div>
                            <div class="rate-display-cell" id="rate-comparison-display-3">
                            </div>
                            <div class="rate-display-cell" id="rate-comparison-display-4">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="rate-info">
                    <div class="info-item">
                        <span class="info-label">Data Source:</span>
                        <span class="info-value">ExchangeRate-API</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Updated:</span>
                        <span class="info-value" id="update-time">--</span>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2024 Cross-Timezone Exchange Rate Tool | Data Source: ExchangeRate-API</p>
        </footer>
    </div>

    <div class="loading-overlay" id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
        <div class="loading-spinner" style="background: white; padding: 20px; border-radius: 5px; text-align: center;">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Fetching latest exchange rates...</p>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div class="confirmation-dialog" id="confirmation-dialog">
        <div class="confirmation-dialog-content">
            <h3>Add to Favorites</h3>
            <p id="confirmation-message">Are you sure you want to add this country to your favorites?</p>
            <div class="confirmation-dialog-buttons">
                <button class="confirmation-dialog-btn cancel" id="cancel-btn">Cancel</button>
                <button class="confirmation-dialog-btn confirm" id="confirm-btn">Add to Favorites</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- 调试功能 -->
    <script>
        // 添加调试功能到全局作用域
        window.debugRateModule = function() {
            console.log('=== 调试汇率模块 ===');
            
            // 1. 检查DOM元素
            console.log('1. 检查DOM元素:');
            const rateBaseCountry = document.getElementById('rate-base-country');
            const rateMainValue = document.getElementById('rate-main-value');
            const rateMainCurrency = document.getElementById('rate-main-currency');
            
            console.log('rate-base-country:', rateBaseCountry ? '存在' : '不存在');
            console.log('rate-main-value:', rateMainValue ? '存在' : '不存在');
            console.log('rate-main-currency:', rateMainCurrency ? '存在' : '不存在');
            
            // 2. 检查比较国家选择器
            console.log('2. 检查比较国家选择器:');
            for (let i = 1; i <= 4; i++) {
                const select = document.getElementById(`rate-comparison-select-${i}`);
                const display = document.getElementById(`rate-comparison-display-${i}`);
                console.log(`比较国家 ${i}:`, {
                    select: select ? '存在' : '不存在',
                    display: display ? '存在' : '不存在',
                    value: select ? select.value : 'N/A'
                });
            }
            
            // 3. 检查汇率数据
            console.log('3. 检查汇率数据:');
            console.log('currentRates:', window.currentRates);
            console.log('汇率数据键数量:', Object.keys(window.currentRates || {}).length);
            
            // 4. 测试汇率转换
            console.log('4. 测试汇率转换:');
            if (window.updateRateDisplay) {
                console.log('调用 updateRateDisplay...');
                window.updateRateDisplay();
                console.log('updateRateDisplay 调用完成');
            } else {
                console.log('updateRateDisplay 函数不存在！');
            }
            
            console.log('=== 调试完成 ===');
        };
        
        // 快速测试函数
        window.quickTestRate = function() {
            console.log('=== 快速测试汇率转换 ===');
            
            // 设置测试数据
            const rateBaseCountry = document.getElementById('rate-base-country');
            const rateMainValue = document.getElementById('rate-main-value');
            
            if (rateBaseCountry) {
                rateBaseCountry.value = 'US';
                console.log('设置主国家为: US');
            }
            
            if (rateMainValue) {
                rateMainValue.value = '100';
                console.log('设置输入值为: 100');
            }
            
            // 设置比较国家
            const select1 = document.getElementById('rate-comparison-select-1');
            const select2 = document.getElementById('rate-comparison-select-2');
            
            if (select1) {
                select1.value = 'CN';
                console.log('设置比较国家1为: CN');
            }
            
            if (select2) {
                select2.value = 'JP';
                console.log('设置比较国家2为: JP');
            }
            
            // 触发更新
            if (window.updateRateDisplay) {
                window.updateRateDisplay();
            }
            
            console.log('=== 快速测试完成 ===');
        };
        
        // 强制设置汇率数据并测试
        window.forceSetRates = function() {
            console.log('=== 强制设置汇率数据 ===');
            
            // 设置模拟汇率数据
            window.currentRates = {
                'CNY': 7.11,
                'JPY': 146.61,
                'EUR': 0.85,
                'GBP': 0.73,
                'VND': 24000,
                'DKK': 6.5,
                'EGP': 30.5
            };
            
            console.log('设置汇率数据:', window.currentRates);
            
            // 设置测试环境
            const rateBaseCountry = document.getElementById('rate-base-country');
            const rateMainValue = document.getElementById('rate-main-value');
            
            if (rateBaseCountry) {
                rateBaseCountry.value = 'US';
                console.log('设置主国家为: US');
            }
            
            if (rateMainValue) {
                rateMainValue.value = '100';
                console.log('设置输入值为: 100');
            }
            
            // 设置比较国家
            const select1 = document.getElementById('rate-comparison-select-1');
            const select2 = document.getElementById('rate-comparison-select-2');
            
            if (select1) {
                select1.value = 'CN';
                console.log('设置比较国家1为: CN');
            }
            
            if (select2) {
                select2.value = 'JP';
                console.log('设置比较国家2为: JP');
            }
            
            // 使用核心的 updateRateDisplay 函数更新显示
            console.log('使用核心函数更新显示...');
            if (window.updateRateDisplay) {
                window.updateRateDisplay();
                console.log('显示更新完成');
            } else {
                console.log('updateRateDisplay 函数不存在！');
            }
            
            console.log('=== 强制设置完成 ===');
        };
        
        // 强制获取汇率数据
        window.forceFetchRates = function() {
            console.log('=== 强制获取汇率数据 ===');
            
            // 设置测试主国家
            const rateBaseCountry = document.getElementById('rate-base-country');
            if (rateBaseCountry) {
                rateBaseCountry.value = 'US';
                console.log('设置主国家为: US');
            }
            
            // 设置比较国家
            const select1 = document.getElementById('rate-comparison-select-1');
            const select2 = document.getElementById('rate-comparison-select-2');
            
            if (select1) {
                select1.value = 'CN';
                console.log('设置比较国家1为: CN');
            }
            
            if (select2) {
                select2.value = 'JP';
                console.log('设置比较国家2为: JP');
            }
            
            // 设置输入值
            const rateMainValue = document.getElementById('rate-main-value');
            if (rateMainValue) {
                rateMainValue.value = '100';
                console.log('设置输入值为: 100');
            }
            
            // 强制调用API
            if (window.fetchExchangeRates) {
                console.log('开始调用 fetchExchangeRates...');
                window.fetchExchangeRates().then(() => {
                    console.log('强制获取汇率数据完成');
                    console.log('当前汇率数据:', window.currentRates);
                    console.log('汇率数据键数量:', Object.keys(window.currentRates || {}).length);
                    
                    // 更新显示
                    if (window.updateRateDisplay) {
                        window.updateRateDisplay();
                    }
                }).catch(error => {
                    console.error('强制获取汇率数据失败:', error);
                    console.log('尝试使用模拟数据...');
                    
                    // 如果API失败，使用模拟数据
                    if (window.loadMockData) {
                        window.loadMockData();
                    }
                });
            } else {
                console.log('fetchExchangeRates 函数不存在！');
            }
        };
        
        // 强制初始化汇率数据（使用模拟数据）
        window.forceInitRates = function() {
            console.log('=== 强制初始化汇率数据 ===');
            
            // 设置测试环境
            const rateBaseCountry = document.getElementById('rate-base-country');
            const rateMainValue = document.getElementById('rate-main-value');
            
            if (rateBaseCountry) {
                rateBaseCountry.value = 'US';
                console.log('设置主国家为: US');
            }
            
            if (rateMainValue) {
                rateMainValue.value = '100';
                console.log('设置输入值为: 100');
            }
            
            // 设置比较国家
            const select1 = document.getElementById('rate-comparison-select-1');
            const select2 = document.getElementById('rate-comparison-select-2');
            
            if (select1) {
                select1.value = 'CN';
                console.log('设置比较国家1为: CN');
            }
            
            if (select2) {
                select2.value = 'JP';
                console.log('设置比较国家2为: JP');
            }
            
            // 强制设置汇率数据
            window.currentRates = {
                'USD': 1.0,
                'CNY': 7.11,
                'JPY': 146.61,
                'EUR': 0.85,
                'GBP': 0.73,
                'VND': 24000,
                'DKK': 6.5,
                'EGP': 30.5
            };
            
            console.log('汇率数据已设置:', window.currentRates);
            console.log('汇率数据键数量:', Object.keys(window.currentRates).length);
            
            // 更新显示
            if (window.updateRateDisplay) {
                window.updateRateDisplay();
                console.log('显示已更新');
            }
            
            console.log('=== 强制初始化完成 ===');
        };
        
        // 测试汇率收藏功能
        window.testRateFavorites = function() {
            console.log('=== 测试汇率收藏功能 ===');
            
            // 1. 设置测试收藏
            console.log('设置测试收藏...');
            window.rateComparisonCountries = ['CN', 'JP', 'GB', 'DE'];
            window.rateMainCountry = 'US';
            
            // 保存到本地存储
            localStorage.setItem('rateComparisonCountries', JSON.stringify(window.rateComparisonCountries));
            localStorage.setItem('rateMainCountry', window.rateMainCountry);
            
            console.log('汇率比较国家收藏:', window.rateComparisonCountries);
            console.log('汇率主国家收藏:', window.rateMainCountry);
            
            // 2. 应用收藏
            console.log('应用收藏...');
            if (window.applyRateFavorites) {
                window.applyRateFavorites();
            }
            
            // 3. 检查结果
            console.log('检查结果...');
            const rateBaseCountry = document.getElementById('rate-base-country');
            console.log('汇率主国家选择器值:', rateBaseCountry ? rateBaseCountry.value : 'N/A');
            
            for (let i = 1; i <= 4; i++) {
                const select = document.getElementById(`rate-comparison-select-${i}`);
                console.log(`汇率比较选择器 ${i}:`, select ? select.value : 'N/A');
            }
            
            console.log('=== 测试完成 ===');
        };
        
        // 手动设置汇率对比国家收藏
        window.setRateComparisonFavorites = function(countries) {
            console.log('=== 手动设置汇率对比国家收藏 ===');
            console.log('设置收藏国家:', countries);
            
            // 设置收藏
            window.rateComparisonCountries = countries;
            
            // 保存到本地存储
            localStorage.setItem('rateComparisonCountries', JSON.stringify(countries));
            
            // 应用收藏
            if (window.applyRateFavorites) {
                window.applyRateFavorites();
            }
            
            // 更新按钮状态
            if (window.updateRateComparisonButtons) {
                window.updateRateComparisonButtons();
            }
            
            console.log('收藏设置完成');
        };
        
        // 检查当前汇率收藏状态
        window.checkRateFavorites = function() {
            console.log('=== 检查当前汇率收藏状态 ===');
            
            // 从本地存储读取
            const storedRateComparison = localStorage.getItem('rateComparisonCountries');
            const storedRateMain = localStorage.getItem('rateMainCountry');
            
            console.log('本地存储的汇率比较国家:', storedRateComparison);
            console.log('本地存储的汇率主国家:', storedRateMain);
            
            // 检查当前变量
            console.log('当前汇率比较国家变量:', window.rateComparisonCountries);
            console.log('当前汇率主国家变量:', window.rateMainCountry);
            
            // 检查DOM状态
            const rateBaseCountry = document.getElementById('rate-base-country');
            console.log('汇率主国家选择器值:', rateBaseCountry ? rateBaseCountry.value : 'N/A');
            
            for (let i = 1; i <= 4; i++) {
                const select = document.getElementById(`rate-comparison-select-${i}`);
                console.log(`汇率比较选择器 ${i}:`, select ? select.value : 'N/A');
            }
            
            console.log('=== 检查完成 ===');
        };
        
        // 测试汇率收藏持久化
        window.testRateFavoritesPersistence = function() {
            console.log('=== 测试汇率收藏持久化 ===');
            
            // 1. 设置测试收藏
            console.log('设置测试收藏...');
            const testCountries = ['CN', 'JP', 'GB', 'DE'];
            
            // 设置收藏
            window.rateComparisonCountries = testCountries;
            localStorage.setItem('rateComparisonCountries', JSON.stringify(testCountries));
            
            console.log('收藏的国家:', testCountries);
            
            // 2. 应用收藏
            console.log('应用收藏...');
            if (window.applyRateFavorites) {
                window.applyRateFavorites();
            }
            
            // 3. 检查结果
            console.log('检查结果...');
            for (let i = 1; i <= 4; i++) {
                const select = document.getElementById(`rate-comparison-select-${i}`);
                const btn = document.querySelector(`[data-target="rate-${i}"]`);
                console.log(`选择器 ${i}:`, select ? select.value : 'N/A');
                console.log(`按钮 ${i} 状态:`, btn ? (btn.classList.contains('active') ? 'ACTIVE' : 'INACTIVE') : 'N/A');
            }
            
            console.log('=== 测试完成 ===');
        };
        
        // 清除汇率收藏
        window.clearRateFavorites = function() {
            console.log('=== 清除汇率收藏 ===');
            window.rateComparisonCountries = [];
            window.rateMainCountry = '';
            localStorage.removeItem('rateComparisonCountries');
            localStorage.removeItem('rateMainCountry');
            console.log('汇率收藏已清除');
            
            // 重新应用收藏（应该是空的）
            if (window.applyRateFavorites) {
                window.applyRateFavorites();
            }
        };
        
        // 调试汇率收藏恢复问题
        window.debugRateFavoritesRestore = function() {
            console.log('=== 调试汇率收藏恢复问题 ===');
            
            // 1. 检查本地存储
            console.log('1. 检查本地存储:');
            const storedRateComparison = localStorage.getItem('rateComparisonCountries');
            const storedRateMain = localStorage.getItem('rateMainCountry');
            console.log('存储的汇率比较国家:', storedRateComparison);
            console.log('存储的汇率主国家:', storedRateMain);
            
            // 2. 检查当前变量
            console.log('2. 检查当前变量:');
            console.log('rateComparisonCountries:', window.rateComparisonCountries);
            console.log('rateMainCountry:', window.rateMainCountry);
            
            // 3. 检查DOM状态
            console.log('3. 检查DOM状态:');
            const rateBaseCountry = document.getElementById('rate-base-country');
            console.log('汇率主国家选择器值:', rateBaseCountry ? rateBaseCountry.value : 'N/A');
            
            for (let i = 1; i <= 4; i++) {
                const select = document.getElementById(`rate-comparison-select-${i}`);
                const btn = document.querySelector(`[data-target="rate-${i}"]`);
                console.log(`选择器 ${i}:`, select ? select.value : 'N/A');
                console.log(`按钮 ${i} 状态:`, btn ? (btn.classList.contains('active') ? 'ACTIVE' : 'INACTIVE') : 'N/A');
            }
            
            // 4. 手动恢复收藏
            console.log('4. 手动恢复收藏:');
            if (storedRateComparison) {
                const countries = JSON.parse(storedRateComparison);
                console.log('解析的收藏国家:', countries);
                
                // 设置变量
                window.rateComparisonCountries = countries;
                
                // 应用收藏
                if (window.applyRateFavorites) {
                    window.applyRateFavorites();
                    console.log('收藏已应用');
                }
            }
            
            console.log('=== 调试完成 ===');
        };
        
        // 调试分钟显示问题
        function debugMinuteDisplay() {
            console.log('=== 调试分钟显示问题 ===');
            const minuteInput = document.getElementById('time-main-minute-input');
            if (minuteInput) {
                console.log('分钟选择器元素:', minuteInput);
                console.log('分钟选择器值:', minuteInput.value);
                console.log('分钟选择器选项数量:', minuteInput.options.length);
                console.log('分钟选择器选项:', Array.from(minuteInput.options).map(opt => opt.value));
                console.log('当前选中选项:', minuteInput.selectedIndex, minuteInput.options[minuteInput.selectedIndex]);
            } else {
                console.error('分钟选择器元素未找到');
            }
            
            // 检查当前时间
            const now = new Date();
            console.log('当前时间:', now);
            console.log('当前分钟:', now.getMinutes());
            console.log('四舍五入到5分钟:', Math.round(now.getMinutes() / 5) * 5);
        }
        
        // 强制设置分钟值
        function forceSetMinute(minute) {
            const minuteInput = document.getElementById('time-main-minute-input');
            if (minuteInput) {
                const minuteStr = minute.toString().padStart(2, '0');
                minuteInput.value = minuteStr;
                console.log('强制设置分钟值:', minuteStr);
            }
        }
    </script>
</body>
</html>
